<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta charset="utf-8" />
    <title>推广费发放 - 天龙健康会员操作平台</title>

    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="/assets/css/bootstrap.css" />
    <link rel="stylesheet" href="/assets/css/font-awesome.css" />

    <!-- page specific plugin styles -->
    <!-- text fonts -->
    <link rel="stylesheet" href="/assets/css/ace-fonts.css" />

    <!-- ace styles -->
    <link rel="stylesheet" href="/assets/css/ace.css" class="ace-main-stylesheet" id="main-ace-style" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="../assets/css/ace-part2.css" class="ace-main-stylesheet" />
    <![endif]-->
    <!--[if lte IE 9]>
      <link rel="stylesheet" href="../assets/css/ace-ie.css" />
    <![endif]-->
    <!-- inline styles related to this page -->
    <!-- ace settings handler -->
    <script src="/assets/js/ace-extra.js"></script>

    <!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->
    <!--[if lte IE 8]>
    <script src="../assets/js/html5shiv.js"></script>
    <script src="../assets/js/respond.js"></script>
    <![endif]-->
    <!-- basic scripts -->
    <!--[if !IE]> -->
    <script type="text/javascript">
        window.jQuery || document.write("<script src='/assets/js/jquery.js'>" + "<" + "/script>");
    </script>

    <!-- <![endif]-->
    <!--[if IE]>
    <script type="text/javascript">
     window.jQuery || document.write("<script src='../assets/js/jquery1x.js'>"+"<"+"/script>");
    </script>
    <![endif]-->
    <script type="text/javascript">
        if ('ontouchstart' in document.documentElement) document.write("<script src='/assets/js/jquery.mobile.custom.js'>" + "<" + "/script>");
    </script>
    <script src="/assets/js/bootstrap.js"></script>
    <script src="/assets/js/Common.js"></script>

</head>

<body class="no-skin">
    <!-- #section:basics/navbar.layout -->
    {% include 'Services/CommonNavBar.html' %}

    <!-- /section:basics/navbar.layout -->
    <div class="main-container" id="main-container">
        <script type="text/javascript">
            try { ace.settings.check('main-container', 'fixed') } catch (e) { }
        </script>

        <!-- #section:basics/sidebar -->
        {% include 'Services/CommonList.html' %}

        <!-- /section:basics/sidebar -->
        <div class="main-content">
            <div class="main-content-inner">
                <!-- #section:basics/content.breadcrumbs -->
                <div class="page-content">

                    <!-- #section:settings.box -->
{% include 'Services/CommonSetting.html' %}
<!-- /.ace-settings-container -->
<!-- /section:settings.box -->

                    <div class="row noMarginLR">
                        <div class="col-xs-12">
                            <!-- PAGE CONTENT BEGINS -->
                            

<link rel="stylesheet" href="/assets/css/datepicker.css" />
<script src="/assets/js/date-time/bootstrap-datepicker.js"></script>
<!-- /section:settings.box -->
<div class="page-header">
    <h1>
        费用中心
        <small>
            <i class="ace-icon fa fa-angle-double-right"></i>
            推广费发放
        </small>
    </h1>
</div><!-- /.page-header -->


<div class="row noMarginLR">
    <div class="col-xs-12">

        <div>
            <form class="form-inline hasBlockToolItem" action="?" method="Get">
                <input id="UserInfo" name="UserInfo" type="text" class="input-sm" placeholder="登陆名" {% if UserInfo != None %} value = "{{UserInfo}} {% endif %}"/>
                <select class="" id="GiftStatus" name="GiftStatus">
                    <option value="3" {% if GiftStatus == "3" %} selected="selected" {% endif %}>所有</option>
                    <option value="0" {% if GiftStatus == "0" %} selected="selected" {% endif %}>暂审核</option>
                    <option value="1" {% if GiftStatus == "1" %} selected="selected" {% endif %}>待发放</option>
                    <option value="2" {% if GiftStatus == "2" %} selected="selected" {% endif %}>已发放</option>
                </select>
                <select class="" id="GiftFrom" name="GiftFrom">
                    <option value="6" {% if GiftFrom == "6" %} selected="selected" {% endif %}>所有奖</option>
                    <option value="0" {% if GiftFrom == "0" %} selected="selected" {% endif %}>推荐奖</option>
                    <option value="1" {% if GiftFrom == "1" %} selected="selected" {% endif %}>优秀推荐奖</option>
                    <option value="2" {% if GiftFrom == "2" %} selected="selected" {% endif %}>超级推荐奖</option>
                    <option value="3" {% if GiftFrom == "3" %} selected="selected" {% endif %}>广告费</option>
                    <option value="4" {% if GiftFrom == "4" %} selected="selected" {% endif %}>网络推荐奖</option>
                    <option value="5" {% if GiftFrom == "5" %} selected="selected" {% endif %}>优秀人才奖</option>
                </select>
                <input class="form-control date-picker" id="AddStart" name="AddStart" type="text" data-date-format="yyyy-mm-dd" style="width:90px;" placeholder="生成时间 起" />
                <input class="form-control date-picker" id="AddEnd" name="AddEnd" type="text" data-date-format="yyyy-mm-dd" style="width:90px;" placeholder="生成时间 止" />

                <input class="form-control date-picker" id="SubStart" name="SubStart" type="text" data-date-format="yyyy-mm-dd" style="width:90px;" placeholder="发放时间 起" />
                <input class="form-control date-picker" id="SubEnd" name="SubEnd" type="text" data-date-format="yyyy-mm-dd" style="width:90px;" placeholder="发放时间 止" />

                <select class="" id="orderby" name="orderby">
                    <option value="1" {% if orderby == "1" %} selected="selected" {% endif %}>生成时间正序</option>
                    <option value="2" {% if orderby == "2" %} selected="selected" {% endif %}>生成时间倒序</option>
                    <option value="3" {% if orderby == "3" %} selected="selected" {% endif %}>发放时间正序</option>
                    <option value="4" {% if orderby == "4" %} selected="selected" {% endif %}>发放时间倒序</option>
                </select>

                <button type="submit" class="btn btn-info btn-sm">
                    <i class="ace-icon glyphicon glyphicon-search"></i>查询
                </button>
            </form>
        </div>
    

        <div class="iWideTable cf">
            <table id="simple-table" class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th style="width:30px;"><input id="chk" type="checkbox" /></th>
                        <th style="width:100px">昵称或姓名</th>
                        <th style="width:120px">手机</th>
                        <th style="width:80px">推广费</th>
                        <th style="width:80px">类别</th>
                        <th style="width:100px">开户行</th>
                        <th style="width:80px">户名</th>
                        <th>账号</th>
                        
                        <th style="width:130px">生成日期</th>
                        <th style="width:130px">发放日期</th>
                        <th style="width:90px">状态</th>
                        <th style="width:30px"></th>
                    </tr>
                </thead>

                <tbody>
                    {% for coms in comslist %}
                        <tr title="推荐会员【】获得推荐奖">
                        <td>
                            {% if GiftStatus == "0" or GiftStatus == "1"%}
                            <input id="" name="chk" type="checkbox" value="{{coms.commission_id}}" data-ms="1">
                            {% endif %}
                        </td>
                        <td>{{coms.user_id.user_name}}</td>
                        <td data-name="mob" style="font-size:14px;">{{coms.user_id.bind_phone}}</td>
                        <td style="text-align:right">{{coms.commission_price}}</td>
                        <td>
                        {% if coms.commission_type.commission_type == "1" %}
                        优秀推荐奖
                        {% elif coms.commission_type.commission_type == "2" %}
                        超级推荐奖
                        {% elif coms.commission_type.commission_type == "3" %}
                        广告费
                        {% elif coms.commission_type.commission_type == "4" %}
                        网络推荐奖
                        {% elif coms.commission_type.commission_type == "5" %}
                        优秀人才奖
                        {% endif %}
                        </td>
                        <td>{{coms.user_id.bank}}</td>
                        <td>{{coms.user_id.card_holder}}</td>
                        <td data-name="BankAccount" style="font-size:14px;">{{coms.user_id.account}}</td>
                        <td>
                        {% if coms.commission_created != None %}
                        {{coms.commission_created}}
                        {% endif %}
                        </td>
                        <td>
                        {% if coms.commission_sent != None %}
                        {{coms.commission_sent}}
                        {% endif %}
                        </td>
                        <td>
                        {% if coms.commission_status == "2" %}
                        已发放
                        {% else %}
                        未发放
                        {% endif %}
                        </td>
                        <td>
                            {% if GiftStatus == "0" %}
                            <button class="btn btn-minier btn-pink Audit" data-id="{{coms.commission_id}}">审核</button>
                            {% elif GiftStatus == "1" %}
                            <button class="btn btn-minier btn-pink Deliver" data-id="{{coms.commission_id}}">发放</button>
                            {% endif %}
                        </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>    

        {% if GiftStatus == "0" %}
        <button class="btn btn-sm btn-pink" id="batAudit">批量审核</button>
        {% elif GiftStatus == "1" %}
        <button class="btn btn-sm btn-pink" id="batDeliver">批量发放</button>
        {% endif %}
    <div>金额合计：{{totalmoney}}</div>
        
<div class="row">
    <div class="col-xs-5 iPagesLeft">
        <div class="dataTables_info" id="sample-table-2_info" role="status" aria-live="polite">
            第 {{curpage}} 页 共 {{pagenum}} 页 共 {{totalnum}} 条记录
        </div> 
    </div>
    <div class="col-xs-7 iPagesRight">
        <div class="dataTables_paginate paging_simple_numbers">
                <ul class="pagination">
                        <li class="paginate_button previous {% if curpage == 1 %} disabled {% endif %}"><a href="?p=1&UserInfo={{UserInfo}}&GiftStatus={{GiftStatus}}&GiftFrom={{GiftFrom}}&AddStart={{AddStart}}&AddEnd={{AddEnd}}&SubStart={{SubStart}}&SubEnd={{SubEnd}}&orderby={{orderby}}">首页</a></li>
                        <li class="paginate_button previous {% if curpage == 1 %} disabled {% endif %}"><a href="?p={{prevpage}}&UserInfo={{UserInfo}}&GiftStatus={{GiftStatus}}&GiftFrom={{GiftFrom}}&AddStart={{AddStart}}&AddEnd={{AddEnd}}&SubStart={{SubStart}}&SubEnd={{SubEnd}}&orderby={{orderby}}">上一页</a></li>
                        {% if preomit == True %}
                        <li class="paginate_button more"><a href="?p={{prevomitpage}}&UserInfo={{UserInfo}}&GiftStatus={{GiftStatus}}&GiftFrom={{GiftFrom}}&AddStart={{AddStart}}&AddEnd={{AddEnd}}&SubStart={{SubStart}}&SubEnd={{SubEnd}}&orderby={{orderby}}">...</a></li>
                        {% endif %}
                        {% for pindex in pageshowlist %}
                        {% if pindex == curpage %}
                        <li class="paginate_button active"><a>{{curpage}}</a></li>
                        {% elif pindex  %}
                        <li class="paginate_button"><a href="?p={{pindex}}&UserInfo={{UserInfo}}&GiftStatus={{GiftStatus}}&GiftFrom={{GiftFrom}}&AddStart={{AddStart}}&AddEnd={{AddEnd}}&SubStart={{SubStart}}&SubEnd={{SubEnd}}&orderby={{orderby}}">{{pindex}}</a></li>
                        {% endif %}
                        {% endfor %}
                        {% if nextomit == True %}
                        <li class="paginate_button more"><a href="?p={{nextomitpage}}&UserInfo={{UserInfo}}&GiftStatus={{GiftStatus}}&GiftFrom={{GiftFrom}}&AddStart={{AddStart}}&AddEnd={{AddEnd}}&SubStart={{SubStart}}&SubEnd={{SubEnd}}&orderby={{orderby}}">...</a></li>
                        {% endif %}
                        <li class="paginate_button next {% if curpage == pagenum %} disabled {% endif %}"><a href="?p={{nextpage}}&UserInfo={{UserInfo}}&GiftStatus={{GiftStatus}}&GiftFrom={{GiftFrom}}&AddStart={{AddStart}}&AddEnd={{AddEnd}}&SubStart={{SubStart}}&SubEnd={{SubEnd}}&orderby={{orderby}}">下一页</a></li>
                        <li class="paginate_button next {% if curpage == pagenum %} disabled {% endif %}"><a href="?p={{pagenum}}&UserInfo={{UserInfo}}&GiftStatus={{GiftStatus}}&GiftFrom={{GiftFrom}}&AddStart={{AddStart}}&AddEnd={{AddEnd}}&SubStart={{SubStart}}&SubEnd={{SubEnd}}&orderby={{orderby}}">末页</a></li>
                </ul>
        </div>
    </div>
</div>
    </div><!-- /.span -->
</div><!-- /.row -->
<script>
    $('.date-picker').datepicker({
        autoclose: true,
        todayHighlight: true
    })

    $('#GiftStatus').click(function () {
        if ($('#GiftStatus').val() == "0" || $('#GiftStatus').val() == "1" || $('#GiftStatus').val() == "3") {
            $('#SubStart,#SubEnd').val('').prop('disabled', true);
        }
        else if ($('#GiftStatus').val() == "2") {
            $('#SubStart,#SubEnd').prop('disabled', false);
        }
    })

    $('#GiftStatus').trigger('click');



    $('#chk').click(function () {
        $('input[name="chk"]').each(function () {
            if ($(this).attr('data-ms') == '2') {
                $(this).prop('checked', $('#chk').prop('checked'))
            }
            if ($(this).attr('data-ms') == '1') {
                $(this).prop('checked', $('#chk').prop('checked'))
            }
        });
    })


    $('.Deliver').click(function () {
        var id = $(this).attr('data-id');
        layer.confirm('你确定已汇款并发送给会员通知短信吗？？', {
            closeBtn: 0,
            icon: 3,
            btn: ['全部确认','仅确定汇款', '暂不确定'] //按钮
        } ,function (index) {
            layer.close(index);
            layer.msg('正在处理中...', { icon: 16 });
            $.post('MoneySub/', { ids: id,msg:1 }, function (json) {
                layer.closeAll('loading');
                if (json.result == "t") {
                    layer.msg('操作成功，正在刷新页面！', { icon: 1 }, function () {
                        location.href = location.href;
                    });
                }
                else if (json.result == "t2") {
                    layer.alert('审核操作成功，但是通知短信发送失败，您需要通过其它方式通知客户！<br>' + json.msg, { icon: 0 }, function () {
                        location.href = parent.location.href;
                        layer.closeAll();
                    });
                }
                else {
                    layer.alert('处理失败！' + json.msg, { icon: 5 });
                }
            }, "json");
        },function (index) {
            layer.close(index);
            layer.msg('正在处理中...', { icon: 16 });
            $.post('MoneySub', { ids: id,msg:0 }, function (json) {
                layer.closeAll('loading');
                if (json.result == "t") {
                    layer.msg('操作成功，正在刷新页面！', { icon: 1 }, function () {
                        location.href = location.href;
                    });
                }
                else {
                    layer.alert('处理失败！' + json.msg, { icon: 5 });
                }
            }, "json");
        })
    });


    $('.Audit').click(function () {
        var id = $(this).attr('data-id');
        layer.confirm('你确定审核通过吗？', { icon: 3 }, function (index) {
            layer.close(index);
            layer.msg('正在处理中...', { icon: 16 });
            $.post('MoneyAudit/', { ids: id }, function (json) {
                layer.closeAll('loading');
                if (json.result == "t") {
                    layer.msg('操作成功，正在刷新页面！', { icon: 1 }, function () {
                        location.href = location.href;
                    });
                }
                else {
                    layer.alert('处理失败！' + json.msg, { icon: 5 });
                }
            }, "json");
        });
    });


    $('#batDeliver').click(function () {
        var ids = new Array();
        $("input[name='chk']").each(function () {
            if ($(this).prop('checked') == true) {
                ids.push($(this).val());
            }
        });
        if (ids.length == 0) {
            layer.alert('您没有选择任何一条数据', { icon: 5 });
        }
        else {

            layer.confirm('你确定已汇款选择的' + ids.length + '条记录并发送给会员通知短信吗？', {
                closeBtn: 0,
                btn: ['全部确认','仅确定汇款', '暂不确定'] //按钮
            }, function () {
                layer.closeAll();
                layer.msg('正在处理中...', { icon: 16 });
                $.post('MoneySub/', { ids: ids.join(','),msg:1 }, function (json) {
                    layer.closeAll('loading');
                    if (json.result == "t") {
                        layer.msg('操作成功，正在刷新页面！', { icon: 1 }, function () {
                            location.href = location.href;
                        });
                    }
                    else if (json.result == "t2") {
                        layer.alert('审核操作成功，但是通知短信发送失败，您需要通过其它方式通知客户！<br>' + json.msg, { icon: 0 }, function () {
                            location.href = parent.location.href;
                            layer.closeAll();
                        });
                    }
                    else {
                        layer.alert('批量审核失败！' + json.msg, { icon: 5 });
                    }
                }, "json");


            }, function () {
                layer.closeAll();
                layer.msg('正在处理中...', { icon: 16 });
                $.post('MoneySub', { ids: ids.join(',') }, function (json) {
                    layer.closeAll('loading');
                    if (json.result == "t") {
                        layer.msg('操作成功，正在刷新页面！', { icon: 1 }, function () {
                            location.href = location.href;
                        });
                    }
                    else {
                        layer.alert('批量审核失败！' + json.msg, { icon: 5 });
                    }
                }, "json");


            });
        }
    });

    $('#batAudit').click(function () {
        var ids = new Array();
        $("input[name='chk']").each(function () {
            if ($(this).prop('checked') == true) {
                ids.push($(this).val());
            }
        });
        if (ids.length == 0) {
            layer.alert('您没有选择任何一条数据', { icon: 5 });
        }
        else {

            layer.confirm('你确定审核选择的' + ids.length + '条记录吗？', {
                btn: ['确定审核', '暂不确定'] //按钮
            }, function () {
                layer.closeAll();
                layer.msg('正在处理中...', { icon: 16 });
                $.post('MoneyAudit/', { ids: ids.join(',') }, function (json) {
                    layer.closeAll('loading');
                    if (json.result == "t") {
                        layer.msg('操作成功，正在刷新页面！', { icon: 1 }, function () {
                            location.href = location.href;
                        });
                    }
                    else {
                        layer.alert('批量审核失败！' + json.msg, { icon: 5 });
                    }
                }, "json");

            }, function () {

            });
        }
    });

    $('td[data-name="mob"]').each(function (x, y) {
        var _n = formatStr($(y).text(), [3, 4, 4, 1], ' ');
        $(y).text(_n);
    })
    $('td[data-name="BankAccount"]').each(function (x, y) {
        var _n = formatStr($(y).text(), [4, 4, 4, 4, 3], ' ');
        $(y).text(_n);
    });
</script>



                            <!-- PAGE CONTENT ENDS -->
                        </div><!-- /.col -->
                    </div><!-- /.row -->
                </div><!-- /.page-content -->
            </div>
        </div><!-- /.main-content -->

        {% include 'Services/CommonFooter.html' %}
    </div><!-- /.main-container -->
    <!-- page specific plugin scripts -->
    <!-- ace scripts -->
    {% include 'Services/CommonScripts.html' %}
</body>
</html>
